import"./scene.DhMoAoZ3.js";import"./game.B9syZ_s7.js";class g{constructor(){this.evidenceScore={total:0,nextReward:100,rewardPoints:3,history:[]},this.detectives={poirot:{name:"Hercule Poirot",title:"Private Detective",image:"./images/Detective.png",avatarImage:"./images/Me.png",background:"A former Belgian police officer turned private detective, is known for his sharp intellect, psychological insight, and obsession with order,  believing that 'the little grey cells' hold the key to solving any mystery.",skillTitle:"Special Ability: Grey Cells",skillText:"In each game, key evidence marked with grey cells will be randomly triggered.",labPoints:10,techPoints:8},Holmes:{name:"Sherlock Holmes",title:"Consulting Detective",image:"./images/sherlock.jpg",avatarImage:"./images/sherlock2.png",background:"A brilliant detective from London, known for his unmatched deductive reasoning, keen observation skills, and ability to solve the most complex of cases.",skillTitle:"Special Ability: The Mind Palace",skillText:"In each game, SherSherlock can visualize mysterious connections between related pieces of evidences.",labPoints:6,techPoints:7}},this.currentDetective="poirot",this.initializeEventListeners(),this.updateMainPoints(),this.updateSwitchButton()}initializeEventListeners(){const e=document.getElementById("detective-switch");e&&e.addEventListener("click",()=>this.switchDetective());const t=document.getElementById("main-detective-switch");t&&t.addEventListener("click",()=>this.switchDetective())}async switchDetective(){this.addSwitchingAnimation(),await new Promise(t=>setTimeout(t,300)),this.currentDetective=this.currentDetective==="poirot"?"Holmes":"poirot";const e=this.detectives[this.currentDetective];this.updateDetectiveContent(e),this.updateSwitchButton(),this.updateMainPoints(),this.updateExternalAvatar(e),setTimeout(()=>this.removeSwitchingAnimation(),300)}updateMainPoints(){const e=this.detectives[this.currentDetective];this.updatePointsWithAnimation("main-lab-points",e.labPoints),this.updatePointsWithAnimation("main-tech-points",e.techPoints)}updatePointsWithAnimation(e,t){const i=document.getElementById(e);i&&(i.classList.add("changing"),i.textContent=t,setTimeout(()=>i.classList.remove("changing"),300))}modifyPoints(e,t){const i=this.detectives[this.currentDetective],n=e.toLowerCase()==="lab"?"labPoints":"techPoints",o=i[n],a=Math.max(0,o+t);i[n]=a;const r=`main-${e.toLowerCase()}-points`,c=e.toLowerCase()==="lab"?"lab-point":"tech-point";this.updatePointsWithAnimation(r,a),this.updatePointsWithAnimation(c,a);const l=document.querySelector(`.${e.toLowerCase()}-points`);return l&&(a===0?l.classList.add("insufficient"):l.classList.remove("insufficient")),a}hasEnoughPoints(e,t){const i=this.detectives[this.currentDetective],n=e.toLowerCase()==="lab"?"labPoints":"techPoints";return i[n]>=t}addSwitchingAnimation(){document.getElementById("detective-profile-img").classList.add("switching"),document.querySelector(".info-section").classList.add("switching"),document.querySelector(".skill-section").classList.add("switching")}removeSwitchingAnimation(){document.getElementById("detective-profile-img").classList.remove("switching"),document.querySelector(".info-section").classList.remove("switching"),document.querySelector(".skill-section").classList.remove("switching")}updateDetectiveContent(e){document.getElementById("detective-profile-img").src=e.image,document.querySelector(".detective-name").textContent=e.name,document.querySelector(".detective-title").textContent=e.title,document.getElementById("detective-background-text").textContent=e.background,document.getElementById("detective-skill-title").textContent=e.skillTitle,document.getElementById("detective-skill-text").textContent=e.skillText,document.getElementById("lab-point").textContent=e.labPoints,document.getElementById("tech-point").textContent=e.techPoints}updateSwitchButton(){const e=this.currentDetective==="poirot"?"Poirot":"Holmes",t=this.currentDetective==="poirot"?"Holmes":"Poirot";document.querySelectorAll(".detective-switch").forEach(n=>{n.querySelector(".current-detective").textContent=e,n.querySelector(".next-detective").textContent=t})}updateExternalAvatar(e){const t=document.getElementById("detective-avatar");t&&(t.src=e.avatarImage)}getFormattedGameTime(){return window.gameTimer?new Date(window.gameTimer.startTime+(Date.now()-window.gameTimer.missionStartTime)*window.gameTimer.speedMultiplier).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):new Date().toLocaleString()}addEvidenceScore(e,t){if(this.evidenceScore.total+=e,this.evidenceScore.history.push({score:e,evidence:t.name,time:this.getFormattedGameTime(),investigator:this.detectives[this.currentDetective].name}),this.evidenceScore.total>=this.evidenceScore.nextReward){const i=Math.random()<.5?"tech":"lab";this.modifyPoints(i,this.evidenceScore.rewardPoints),window.panoramaScene&&window.panoramaScene.showNotification(`Breakthrough! Gained ${this.evidenceScore.rewardPoints} ${i} points from evidence analysis.`),this.evidenceScore.nextReward+=100,this.evidenceScore.rewardPoints+=1}}}document.addEventListener("DOMContentLoaded",()=>{window.detectiveManager=new g});const h={en:{timerConfirm:"Are you sure you want to reset the Game?<br>Your inquiry records and evidence will disappear."}};class p{constructor(){const e=new Date;this.startTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),17,0,0).getTime(),this.missionStartTime=new Date().getTime(),this.timerElement=document.getElementById("timer"),this.anotherElement=document.getElementById("mission"),this.missionTimerElement=document.getElementById("mission-timer"),this.isRunning=!1,this.timerInterval=null,this.speedMultiplier=60,this.isFirstLayer=!1,this.hasCompletedStickers=!1,this.initialized=!1,this.conversationPointsElement=document.createElement("div"),this.conversationPointsElement.className="points-container conversation-points",this.conversationPointsElement.innerHTML=`
            <div class="points-icon"><img src="./images/Chat.png" alt="Chat" style="width: 60px; height: 60px;"></div>
            <div class="points-info">
                <div class="points-label">Chat Points</div>
                <div class="points-value" id="conversation-points">11</div>
            </div>
        `,document.querySelector(".points-display").appendChild(this.conversationPointsElement),this.SCENE_INTRO=0,this.SCENE_TRANSITION=1,this.SCENE_LIVING_ROOM=2,this.SCENE_MARK_ROOM=3,this.SCENE_JOHN_ROOM=4,this.SCENE_AMY_ROOM=5,this.SCENE_LINNA_ROOM=6,this.currentScene=this.SCENE_INTRO,window.location.hash==="#completed"?(this.hasCompletedStickers=!0,window.history.replaceState(null,null,window.location.pathname),this.isRunning=!0,this.setTimerActive(!0)):this.setTimerActive(!1),this.pauseButton=document.getElementById("pause-button"),this.resetButton=document.getElementById("reset-button"),this.pauseOverlay=document.querySelector(".pause-overlay"),this.pauseOverlay&&(this.pauseOverlay.style.zIndex="10000"),this.updateMainTimer(new Date(this.startTime)),this.updateMissionTimer(new Date(0)),this.eventManager=new EventManager(this),this.backgroundUpdates=["./images/scene0.png","./images/scene0.5.png",{type:"cube",sceneName:"livingroom",images:{right:"./images/livingroom/cube_left.png",left:"./images/livingroom/cube_right.png",top:"./images/livingroom/cube_up.png",bottom:"./images/livingroom/cube_down.png",front:"./images/livingroom/cube_front.png",back:"./images/livingroom/cube_back.png"}},{type:"cube",sceneName:"markroom",images:{right:"./images/markroom/cube_right.png",left:"./images/markroom/cube_left.png",top:"./images/markroom/cube_up.png",bottom:"./images/markroom/cube_down.png",front:"./images/markroom/cube_front.png",back:"./images/markroom/cube_back.png"}},{type:"cube",sceneName:"johnroom",images:{right:"./images/johnroom/cube_right.png",left:"./images/johnroom/cube_left.png",top:"./images/johnroom/cube_up.png",bottom:"./images/johnroom/cube_down.png",front:"./images/johnroom/cube_front.png",back:"./images/johnroom/cube_back.png"}},{type:"cube",sceneName:"amyroom",images:{right:"./images/amyroom/cube_right.png",left:"./images/amyroom/cube_left.png",top:"./images/amyroom/cube_up.png",bottom:"./images/amyroom/cube_down.png",front:"./images/amyroom/cube_front.png",back:"./images/amyroom/cube_back.png"}},{type:"cube",sceneName:"linnaroom",images:{right:"./images/linnaroom/cube_right.png",left:"./images/linnaroom/cube_left.png",top:"./images/linnaroom/cube_up.png",bottom:"./images/linnaroom/cube_down.png",front:"./images/linnaroom/cube_front.png",back:"./images/linnaroom/cube_back.png"}}],this.initBackgroundImage(),this.initTimerControls(),this.initSceneButtons(),this.preloadImages();const i=document.getElementById("detective-avatar"),n=document.getElementById("detective-card"),o=n.querySelector(".close-detail");i.addEventListener("click",()=>{n.style.display=n.style.display==="none"?"block":"none"}),o.addEventListener("click",()=>{n.style.display="none"}),window.addEventListener("click",c=>{if(c.target===n){n.style.display="none";return}const l=document.querySelector(".background-container"),m=document.querySelector(".background-image");if(this.isFirstLayer&&(c.target===l||c.target===m)){l.style.zIndex="1",this.switchToScene(this.SCENE_TRANSITION),this.isFirstLayer=!1,!this.isRunning&&this.hasCompletedStickers&&(this.isRunning=!0,this.missionStartTime=new Date().getTime());return}if(!this.isRunning&&this.pauseOverlay&&this.pauseOverlay.style.display==="block"&&!this.pauseOverlay.contains(c.target)&&!this.pauseButton.contains(c.target)&&(console.log("ç‚¹å‡»çª—å£éžæŒ‰é’®åŒºåŸŸï¼Œæ¢å¤æ¸¸æˆ"),this.isRunning=!0,this.pauseOverlay.style.display="none",this.pauseTime)){const d=new Date().getTime()-this.pauseTime;this.missionStartTime+=d,console.log("çª—å£ç‚¹å‡»ï¼šæ¸¸æˆæ¢å¤ï¼Œè°ƒæ•´äº†å¼€å§‹æ—¶é—´ï¼Œæš‚åœæŒç»­:",d,"ms")}});const a=document.getElementById("lab-points"),r=document.getElementById("tech-points");a&&(a.style.color="green"),r&&(r.style.color="blue"),this.subscribers=[],this.timerInterval=setInterval(()=>{if(this.isRunning){const c=new Date().getTime(),l=(c-this.missionStartTime)*this.speedMultiplier,m=new Date(this.startTime+l);this.updateMainTimer(m);const u=(c-this.missionStartTime)*this.speedMultiplier,d=new Date(u);this.updateMissionTimer(d),this.notifySubscribers(),this.eventManager.checkEvents(u)}},1e3)}preloadImages(){console.log("é¢„åŠ è½½åœºæ™¯å›¾ç‰‡..."),this.backgroundUpdates.forEach((e,t)=>{if(typeof e=="string"){const i=new Image;i.src=e,console.log(`é¢„åŠ è½½åœºæ™¯ ${t}: ${e}`)}else typeof e=="object"&&e.type==="cube"&&Object.values(e.images).forEach(i=>{const n=new Image;n.src=i,console.log(`é¢„åŠ è½½å…¨æ™¯å›¾: ${i}`)})})}initTimer(){if(!this.initialized)return this.initialized=!0,console.log("åˆå§‹åŒ–è®¡æ—¶å™¨..."),this.missionStartTime=new Date().getTime(),this.hasCompletedStickers&&this.setTimerActive(!0),this.timerInterval=setInterval(()=>{if(this.isRunning){const e=new Date().getTime(),t=(e-this.missionStartTime)*this.speedMultiplier,i=new Date(this.startTime+t);this.updateMainTimer(i);const n=(e-this.missionStartTime)*this.speedMultiplier,o=new Date(n);this.updateMissionTimer(o),this.eventManager.checkEvents(n)}},1e3),!0}updateMainTimer(e){const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");this.timerElement.textContent=`${t}/${i}/${n} ${o}:${a}:${r}`}updateMissionTimer(e){const t=String(Math.floor(e.getTime()/36e5)).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");this.missionTimerElement.textContent=`${t}:${i}:${n}`}clearChatHistory(){try{if(window.questioningModal&&window.questioningModal.chatHistory){for(const t in window.questioningModal.chatHistory)window.questioningModal.chatHistory[t]=[];console.log("æ‰€æœ‰è§’è‰²çš„èŠå¤©è®°å½•å·²æ¸…ç©º");const e=document.getElementById("chat-box");e&&(e.innerHTML="",console.log("èŠå¤©æ¡†å·²æ¸…ç©º"))}else console.log("æ‰¾ä¸åˆ° questioningModal æˆ–å…¶èŠå¤©åŽ†å²è®°å½•")}catch(e){console.error("æ¸…ç©ºèŠå¤©è®°å½•æ—¶å‡ºé”™:",e)}}resetTimer(){console.log("é‡ç½®è®¡æ—¶å™¨åˆ°åˆå§‹çŠ¶æ€");const e=document.getElementById("timer-modal");e&&(e.style.display="none",console.log("å…³é—­é‡ç½®ç¡®è®¤çª—å£"));const t=new Date;this.startTime=new Date(t.getFullYear(),t.getMonth(),t.getDate(),17,0,0).getTime(),this.missionStartTime=new Date().getTime(),this.isRunning=!0,this.initialized=!1,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.initTimer(),this.updateMainTimer(new Date(this.startTime)),this.updateMissionTimer(new Date(0)),this.eventManager&&this.eventManager.events&&this.eventManager.events.forEach(n=>n.triggered=!1);try{this.clearChatHistory(),window.questioningModal&&(window.questioningModal.sendCount=8,window.questioningModal.updateSendButton(),console.log("èŠå¤©åŠŸèƒ½å·²é‡ç½®ï¼Œå¯¹è¯æ¬¡æ•°æ¢å¤ä¸º8æ¬¡"))}catch(n){console.error("é‡ç½®èŠå¤©åŠŸèƒ½æ—¶å‡ºé”™:",n)}const i=document.querySelector(".background-container");i&&(i.style.zIndex="-999"),console.log("è®¡æ—¶å™¨å·²é‡ç½®ï¼Œä¿æŒstickerså®ŒæˆçŠ¶æ€")}initTimerControls(){this.pauseButton.addEventListener("click",()=>{if(console.log("ç‚¹å‡»äº†æš‚åœæŒ‰é’®ï¼Œå½“å‰çŠ¶æ€:",this.isRunning),this.isRunning)this.isRunning=!1,this.pauseOverlay.style.display="block",this.pauseTime=new Date().getTime(),this.pauseOverlay.style.zIndex="10000",console.log("æŒ‰é’®ç‚¹å‡»ï¼šæ¸¸æˆæš‚åœï¼Œè®°å½•æš‚åœæ—¶é—´:",this.pauseTime);else if(this.isRunning=!0,this.pauseOverlay.style.display="none",this.pauseTime){const t=new Date().getTime()-this.pauseTime;this.missionStartTime+=t,console.log("æŒ‰é’®ç‚¹å‡»ï¼šæ¸¸æˆæ¢å¤ï¼Œè°ƒæ•´äº†å¼€å§‹æ—¶é—´ï¼Œæš‚åœæŒç»­:",t,"ms")}console.log("æŒ‰é’®ç‚¹å‡»åŽæ¸¸æˆçŠ¶æ€:",this.isRunning)}),this.resetButton.addEventListener("click",()=>{document.getElementById("modal-title").textContent="Reset Timer",document.querySelector("#timer-modal .modal-body p").innerHTML=h.en.timerConfirm.replace(/\n/g,"<br>"),document.getElementById("timer-yes").textContent="Yes",document.getElementById("timer-no").textContent="No",document.getElementById("timer-modal").style.display="block"}),this.pauseOverlay.addEventListener("click",e=>{if(e.stopPropagation(),console.log("ç‚¹å‡»äº†æš‚åœé®ç½©å±‚ï¼Œå½“å‰è¿è¡ŒçŠ¶æ€:",this.isRunning),this.isRunning=!0,this.pauseOverlay.style.display="none",this.pauseTime){const i=new Date().getTime()-this.pauseTime;this.missionStartTime+=i,console.log("é®ç½©å±‚ç‚¹å‡»ï¼šæ¸¸æˆæ¢å¤ï¼Œè°ƒæ•´äº†å¼€å§‹æ—¶é—´ï¼Œæš‚åœæŒç»­:",i,"ms")}console.log("é®ç½©å±‚ç‚¹å‡»åŽï¼Œæ¸¸æˆçŠ¶æ€:",this.isRunning)})}initSceneButtons(){[document.getElementById("scene1-btn"),document.getElementById("scene2-btn"),document.getElementById("scene3-btn"),document.getElementById("scene4-btn"),document.getElementById("scene5-btn")].forEach((t,i)=>{t&&t.addEventListener("click",()=>{const n=i+2;console.log(`ç‚¹å‡»äº†åœºæ™¯æŒ‰é’® ${i}, å°†åˆ‡æ¢åˆ°åœºæ™¯ ${n}`),n===this.SCENE_LIVING_ROOM&&console.log("å®¢åŽ…åœºæ™¯æŒ‰é’®è¢«ç‚¹å‡»ï¼Œå‡†å¤‡åˆ‡æ¢åˆ°å…¨æ™¯æ¨¡å¼"),this.switchToScene(n)})})}updateSceneButtons(e){[document.getElementById("scene1-btn"),document.getElementById("scene2-btn"),document.getElementById("scene3-btn"),document.getElementById("scene4-btn"),document.getElementById("scene5-btn")].forEach((i,n)=>{i&&(n+2===e?i.classList.add("active-scene"):i.classList.remove("active-scene"))})}initBackgroundImage(){const e=document.querySelector(".background-image");e&&(e.style.backgroundImage="url('./images/scene0.png')",e.style.opacity="1",e.style.pointerEvents="auto",console.log("åˆå§‹èƒŒæ™¯å›¾ç‰‡å·²è®¾ç½®ä¸ºscene0.png"));const t=document.querySelector(".background-container");t&&(t.style.zIndex="9999",t.style.pointerEvents="auto",console.log("èƒŒæ™¯å®¹å™¨z-indexå·²è®¾ç½®ä¸º9999")),this.isFirstLayer=!0}updateBackgroundImages(e){console.log(`Switching to scene: ${e}`);const t=document.querySelector(".background-container"),i=document.querySelector(".background-image");if(e===this.SCENE_INTRO)this.isFirstLayer=!0,t&&(t.style.zIndex="9999",t.style.pointerEvents="auto"),i&&(i.style.opacity="1",i.style.backgroundImage="url('./images/scene0.png')",i.style.pointerEvents="auto",console.log("å·²è®¾ç½®scene0.pngä¸ºèƒŒæ™¯å›¾ç‰‡")),this.hasCompletedStickers||(this.isRunning=!1);else if(e===this.SCENE_TRANSITION)this.isFirstLayer=!1,t&&(t.style.zIndex="1",t.style.pointerEvents="none"),i&&(i.style.opacity="0",i.style.pointerEvents="none",setTimeout(()=>{i.style.backgroundImage="url('./images/scene0.5.png')",i.style.opacity="1",console.log("å·²åˆ‡æ¢åˆ°è¿‡æ¸¡åœºæ™¯scene0.5.png")},500));else{this.isFirstLayer=!1,t&&(t.style.zIndex="1",t.style.pointerEvents="none");const n=this.backgroundUpdates[e];if(n&&n.type==="cube")if(console.log(`å°è¯•åˆ‡æ¢åˆ°å…¨æ™¯åœºæ™¯: ${n.sceneName}`),i&&(i.style.opacity="0",i.style.pointerEvents="none",console.log("èƒŒæ™¯å›¾ç‰‡è®¾ç½®ä¸ºä¸å¯è§")),window.panoramaScene){console.log("å‘çŽ°å…¨æ™¯åœºæ™¯å®žä¾‹ï¼Œå³å°†åˆ‡æ¢"),window.panoramaScene.switchScene(n),console.log("å…¨æ™¯åœºæ™¯åˆ‡æ¢å®Œæˆ");return}else console.error("å…¨æ™¯åœºæ™¯å®žä¾‹ä¸å­˜åœ¨");else console.log("éžå…¨æ™¯åœºæ™¯ï¼Œä½¿ç”¨é™æ€å›¾ç‰‡"),window.panoramaScene&&window.panoramaScene.renderer&&(window.panoramaScene.renderer.domElement.style.display="none",console.log("å…¨æ™¯æ¸²æŸ“å™¨å·²éšè—")),i&&(i.style.opacity="0",i.style.pointerEvents="none",setTimeout(()=>{typeof n=="string"&&(i.style.backgroundImage=`url('${n}')`,i.style.opacity="1",console.log(`èƒŒæ™¯å›¾ç‰‡å·²æ›´æ–°ä¸º: ${n}`))},500))}this.pauseOverlay&&(this.pauseOverlay.style.zIndex="10000")}switchToScene(e){let t;if(typeof e=="number")if(e>=0&&e<this.backgroundUpdates.length)t=this.backgroundUpdates[e],this.currentScene=e,this.updateSceneButtons(e),console.log(`åœºæ™¯å·²åˆ‡æ¢åˆ°ç´¢å¼• ${e}, å½“å‰åœºæ™¯: ${this.currentScene}`);else{console.error(`æ— æ•ˆçš„åœºæ™¯ç´¢å¼•: ${e}`);return}else t=e,console.log(`ç›´æŽ¥åˆ‡æ¢åˆ°æŒ‡å®šè·¯å¾„: ${t}`);console.log("ç›´æŽ¥åˆ‡æ¢åœºæ™¯åˆ°:",t),this.isFirstLayer=!1;const i=document.querySelector(".background-container");if(i&&(i.style.zIndex="1",console.log("èƒŒæ™¯å®¹å™¨z-indexè®¾ç½®ä¸º1")),this.pauseOverlay&&(this.pauseOverlay.style.zIndex="10000"),typeof t=="object"&&t.type==="cube"){console.log(`æ£€æµ‹åˆ°å…¨æ™¯åœºæ™¯: ${t.sceneName}ï¼Œå‡†å¤‡åˆ‡æ¢åˆ°å…¨æ™¯æ¨¡å¼`);const n=document.querySelector(".background-image");if(n&&(n.style.opacity="0",console.log("èƒŒæ™¯å›¾ç‰‡è®¾ç½®ä¸ºä¸å¯è§")),window.panoramaScene){console.log("å‘çŽ°å…¨æ™¯åœºæ™¯å®žä¾‹ï¼Œå³å°†åˆ‡æ¢å…¨æ™¯"),i&&(i.style.zIndex="1"),window.panoramaScene.renderer&&window.panoramaScene.renderer.domElement&&(window.panoramaScene.renderer.domElement.style.zIndex="10",window.panoramaScene.renderer.domElement.style.display="block",console.log("å…¨æ™¯æ¸²æŸ“å™¨z-indexè®¾ç½®ä¸º10ï¼Œå¹¶è®¾ç½®ä¸ºå¯è§")),setTimeout(()=>{window.panoramaScene.switchScene(t),console.log("å…¨æ™¯åœºæ™¯åˆ‡æ¢å®Œæˆ")},10);return}else console.error("å…¨æ™¯åœºæ™¯å®žä¾‹ä¸å­˜åœ¨")}else{console.log("éžå…¨æ™¯åœºæ™¯ï¼Œä½¿ç”¨é™æ€å›¾ç‰‡"),window.panoramaScene&&window.panoramaScene.renderer&&(window.panoramaScene.renderer.domElement.style.display="none",console.log("å…¨æ™¯æ¸²æŸ“å™¨å·²éšè—"));const n=document.querySelector(".background-image");n&&(n.style.opacity="0",setTimeout(()=>{typeof t=="string"&&(n.style.backgroundImage=`url('${t}')`,n.style.opacity="1",console.log(`èƒŒæ™¯å›¾ç‰‡å·²æ›´æ–°ä¸º: ${t}`))},500))}}initDraggableBackground(){const e=document.querySelector(".background-image");let t=!1,i,n,o,a;e.addEventListener("mousedown",r=>{t=!0,i=r.clientX,n=r.clientY;const c=getComputedStyle(e).transform;if(c!=="none"){const l=new DOMMatrix(c);o=l.m41,a=l.m42}else o=0,a=0}),window.addEventListener("mousemove",r=>{if(!t)return;let c=r.clientX-i+o,l=r.clientY-n+a;e.style.transform=`translate(${c}px, ${l}px)`}),window.addEventListener("mouseup",()=>{t=!1}),e.addEventListener("touchstart",r=>{t=!0;const c=r.touches[0];i=c.clientX,n=c.clientY;const l=getComputedStyle(e).transform;if(l!=="none"){const m=new DOMMatrix(l);o=m.m41,a=m.m42}else o=0,a=0}),window.addEventListener("touchmove",r=>{if(!t)return;const c=r.touches[0];let l=c.clientX-i+o,m=c.clientY-n+a;e.style.transform=`translate(${l}px, ${m}px)`}),window.addEventListener("touchend",()=>{t=!1})}setTimerActive(e){const t=[this.timerElement,this.anotherElement,this.missionTimerElement],i=document.querySelectorAll(".timer-label");e?(t.forEach(n=>{n&&(n.style.color="#4CAF50",n.style.textShadow="0 0 10px rgba(76, 175, 80, 0.7)")}),i.forEach(n=>{n&&(n.style.color="#4CAF50",n.style.textShadow="0 0 5px rgba(76, 175, 80, 0.3)")})):(t.forEach(n=>{n&&(n.style.color="#888888",n.style.textShadow="none")}),i.forEach(n=>{n&&(n.style.color="#888888",n.style.textShadow="none")}))}updateConversationPoints(e){const t=document.getElementById("conversation-points");t&&(t.textContent=e,e===0?this.conversationPointsElement.classList.add("insufficient"):this.conversationPointsElement.classList.remove("insufficient"))}subscribe(e){typeof e=="function"&&this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!==e)}notifySubscribers(){const e=new Date(this.startTime+(Date.now()-this.missionStartTime)*this.speedMultiplier);this.subscribers.forEach(t=>{try{t(e)}catch(i){console.error("Error in time update subscriber:",i)}})}getCurrentTime(){return new Date(this.startTime+(Date.now()-this.missionStartTime)*this.speedMultiplier)}}class y{constructor(){this.modal=document.getElementById("modal"),this.timerModal=document.getElementById("timer-modal"),this.initCloseButtons(),this.initTimerButtons()}initCloseButtons(){const e=document.getElementsByClassName("close");Array.from(e).forEach(t=>{t.addEventListener("click",()=>{this.modal.style.display="none",this.timerModal.style.display="none"})}),window.addEventListener("click",t=>{t.target===this.modal&&(this.modal.style.display="none"),t.target===this.timerModal&&(this.timerModal.style.display="none")})}initTimerButtons(){document.getElementById("timer-yes").addEventListener("click",()=>{this.timerModal.style.display="none",console.log("ç‚¹å‡»'Yes'æŒ‰é’®ï¼Œå…³é—­é‡ç½®ç¡®è®¤çª—å£"),gameTimer.resetTimer()}),document.getElementById("timer-no").addEventListener("click",()=>{this.timerModal.style.display="none",console.log("ç‚¹å‡»'No'æŒ‰é’®ï¼Œå…³é—­é‡ç½®ç¡®è®¤çª—å£")})}show(e,t){document.getElementById("modal-title").textContent=e,document.getElementById("modal-body").innerHTML=t,this.modal.style.display="block"}hide(){this.modal.style.display="none"}}class v{constructor(){this.modal=new y,this.evidencePage=null,this.initButtons()}initButtons(){document.getElementById("evidence").addEventListener("click",()=>{this.evidencePage||(this.evidencePage=new EvidencePage),this.evidencePage.modal.style.display="block"}),document.getElementById("events").addEventListener("click",()=>{gameTimer.eventManager.showEvents()})}}window.gameTimer=new p;new v;document.documentElement.lang="en";document.addEventListener("DOMContentLoaded",function(){const s=document.querySelector(".disclaimer-sticker"),e=s.querySelector(".sticker-button");e&&e.addEventListener("click",()=>{s.style.opacity="0",s.style.transform="translate(-50%, -50%) rotate(-1deg) scale(0.8)",setTimeout(()=>{s.remove(),window.gameTimer&&window.gameTimer.hasCompletedStickers&&setTimeout(()=>{const t=document.querySelector(".drag-hint");t&&(t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},1e3))},500)},300)}),setTimeout(function(){if(window.gameTimer){const t=document.querySelector(".background-image");t&&t.addEventListener("click",function(){window.gameTimer.currentScene===window.gameTimer.SCENE_INTRO&&(window.gameTimer.switchToScene(window.gameTimer.SCENE_TRANSITION),console.log("å·²åˆ‡æ¢åˆ°è¿‡æ¸¡åœºæ™¯"))})}else console.error("gameTimeræœªåˆå§‹åŒ–ï¼Œæ— æ³•åˆ‡æ¢åœºæ™¯")},1e3)});document.addEventListener("DOMContentLoaded",function(){const s=document.querySelector(".disclaimer-banner");s&&(s.addEventListener("click",function(){s.style.opacity="0",setTimeout(()=>{s.style.display="none"},500)}),s.style.opacity="0",s.style.transition="opacity 0.5s ease",setTimeout(()=>{s.style.opacity="1"},100))});document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("bgm"),e=document.getElementById("music-toggle"),t=e.querySelector(".music-icon");s.addEventListener("loadeddata",()=>{console.log("éŸ³é¢‘æ–‡ä»¶åŠ è½½æˆåŠŸ")}),s.addEventListener("error",n=>{console.error("éŸ³é¢‘åŠ è½½å¤±è´¥:",n)}),s.volume=.3,localStorage.getItem("bgmMuted")==="true"&&(s.muted=!0,t.textContent="ðŸ”‡",t.style.opacity="0.5"),document.addEventListener("click",function n(){s.playing||s.play().catch(function(o){console.log("æ’­æ”¾éŸ³ä¹å¤±è´¥:",o)}),document.removeEventListener("click",n)},{once:!0}),e.addEventListener("click",function(n){n.stopPropagation(),s.muted?(s.muted=!1,t.textContent="ðŸ”Š",t.style.opacity="1",localStorage.setItem("bgmMuted","false")):(s.muted=!0,t.textContent="ðŸ”‡",t.style.opacity="0.5",localStorage.setItem("bgmMuted","true"))}),window.gameTimer&&window.gameTimer.pauseButton.addEventListener("click",()=>{window.gameTimer.isRunning?s.pause():s.play().catch(function(n){console.log("æ¢å¤æ’­æ”¾å¤±è´¥:",n)})})});document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("scenes-menu-btn"),e=document.getElementById("scenes-dropdown");if(s&&e){s.addEventListener("click",function(n){n.stopPropagation(),e.classList.toggle("show"),s.classList.toggle("active")}),document.addEventListener("click",function(n){!e.contains(n.target)&&n.target!==s&&(e.classList.remove("show"),s.classList.remove("active"))});const t=[{mobile:"mobile-scene1-btn",desktop:"scene1-btn"},{mobile:"mobile-scene2-btn",desktop:"scene2-btn"},{mobile:"mobile-scene3-btn",desktop:"scene3-btn"},{mobile:"mobile-scene4-btn",desktop:"scene4-btn"},{mobile:"mobile-scene5-btn",desktop:"scene5-btn"}];t.forEach(n=>{const o=document.getElementById(n.mobile),a=document.getElementById(n.desktop);o&&a&&o.addEventListener("click",function(){a.click(),document.querySelectorAll("#scenes-dropdown button").forEach(r=>{r.classList.remove("active-scene")}),o.classList.add("active-scene"),e.classList.remove("show"),s.classList.remove("active")})});const i=function(){t.forEach(n=>{const o=document.getElementById(n.mobile),a=document.getElementById(n.desktop);o&&a&&a.classList.contains("active-scene")?(o.classList.add("active-scene"),s.textContent=o.textContent):o&&o.classList.remove("active-scene")})};document.querySelectorAll(".scene-buttons button:not(.scene-menu-toggle)").forEach(n=>{n.addEventListener("click",i)}),i()}});
